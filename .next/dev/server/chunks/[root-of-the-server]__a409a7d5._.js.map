{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/tylercharles/TheConsumer/web/src/lib/env.ts"],"sourcesContent":["export const env = {\n  appName: process.env.NEXT_PUBLIC_APP_NAME || 'The Consumer',\n  themePrimary: process.env.THEME_PRIMARY || '#ff6a00',\n  stripeSecretKey: process.env.STRIPE_SECRET_KEY || '',\n  stripeWebhookSecret: process.env.STRIPE_WEBHOOK_SECRET || '',\n  twilio: {\n    sid: process.env.TWILIO_ACCOUNT_SID || '',\n    token: process.env.TWILIO_AUTH_TOKEN || '',\n    verifySid: process.env.TWILIO_VERIFY_SID || ''\n  },\n  postmarkToken: process.env.POSTMARK_SERVER_TOKEN || '',\n  emailFrom: process.env.EMAIL_FROM || 'The Consumer <no-reply@theconsumer.com>',\n  aws: {\n    region: process.env.AWS_REGION || 'us-east-1',\n    bucket: process.env.AWS_S3_BUCKET || '',\n    accessKeyId: process.env.AWS_ACCESS_KEY_ID || '',\n    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || ''\n  },\n  tremendous: {\n    apiKey: process.env.TREMENDOUS_API_KEY || '',\n    fundingSourceId: process.env.TREMENDOUS_FUNDING_SOURCE_ID || ''\n  }\n};\n\n\n\n"],"names":[],"mappings":";;;;AAAO,MAAM,MAAM;IACjB,SAAS,QAAQ,GAAG,CAAC,oBAAoB,IAAI;IAC7C,cAAc,QAAQ,GAAG,CAAC,aAAa,IAAI;IAC3C,iBAAiB,QAAQ,GAAG,CAAC,iBAAiB,IAAI;IAClD,qBAAqB,QAAQ,GAAG,CAAC,qBAAqB,IAAI;IAC1D,QAAQ;QACN,KAAK,QAAQ,GAAG,CAAC,kBAAkB,IAAI;QACvC,OAAO,QAAQ,GAAG,CAAC,iBAAiB,IAAI;QACxC,WAAW,QAAQ,GAAG,CAAC,iBAAiB,IAAI;IAC9C;IACA,eAAe,QAAQ,GAAG,CAAC,qBAAqB,IAAI;IACpD,WAAW,QAAQ,GAAG,CAAC,UAAU,IAAI;IACrC,KAAK;QACH,QAAQ,QAAQ,GAAG,CAAC,UAAU,IAAI;QAClC,QAAQ,QAAQ,GAAG,CAAC,aAAa,IAAI;QACrC,aAAa,QAAQ,GAAG,CAAC,iBAAiB,IAAI;QAC9C,iBAAiB,QAAQ,GAAG,CAAC,qBAAqB,IAAI;IACxD;IACA,YAAY;QACV,QAAQ,QAAQ,GAAG,CAAC,kBAAkB,IAAI;QAC1C,iBAAiB,QAAQ,GAAG,CAAC,4BAA4B,IAAI;IAC/D;AACF","debugId":null}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":["file:///Users/tylercharles/TheConsumer/web/src/app/api/creatives/submit/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { env } from '@/lib/env';\n\nconst activeByAdvertiser = new Map<string, string>(); // advertiserId -> creativeId\n\nasync function openAiModerate(input: string) {\n  if (!env || !('' + (process as any)?.env?.OPENAI_API_KEY)) return { flagged: false, reasons: [] };\n  try {\n    const res = await fetch('https://api.openai.com/v1/moderations', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${process.env.OPENAI_API_KEY}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ model: 'omni-moderation-latest', input })\n    });\n    if (!res.ok) {\n      const txt = await res.text();\n      console.warn('OpenAI moderation error:', txt);\n      return { flagged: false, reasons: [] };\n    }\n    const data = await res.json();\n    const result = data?.results?.[0];\n    const flagged = !!result?.flagged;\n    const reasons = Object.entries(result?.categories || {})\n      .filter(([, v]) => v)\n      .map(([k]) => k);\n    return { flagged, reasons };\n  } catch (e) {\n    console.warn('OpenAI moderation request failed:', e);\n    return { flagged: false, reasons: [] };\n  }\n}\n\nasync function fetchPlainText(url: string): Promise<string> {\n  const res = await fetch(url, { headers: { 'User-Agent': 'TheConsumerBot/1.0 (+https://theconsumer.net)' } });\n  const html = await res.text();\n  return html\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, ' ')\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, ' ')\n    .replace(/<[^>]+>/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .slice(0, 12000);\n}\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json();\n  const { id, advertiserId, videoUrl, title, description, advertiserUrl, quiz } = body || {};\n  if (!id || !advertiserId || !videoUrl) return NextResponse.json({ error: 'Missing fields' }, { status: 400 });\n\n  // Auto-replace existing active ad instead of requiring pause\n  const existingAd = activeByAdvertiser.get(advertiserId);\n  if (existingAd && existingAd !== id) {\n    console.log(`Replacing existing ad ${existingAd} with new ad ${id} for advertiser ${advertiserId}`);\n  }\n\n  // OpenAI text moderation on provided metadata (title/description)\n  const textToCheck = [title, description].filter(Boolean).join('\\n');\n  const ai = await openAiModerate(textToCheck || '');\n  if (ai.flagged) {\n    return NextResponse.json({ id, status: 'rejected', reasons: ai.reasons }, { status: 200 });\n  }\n\n  // Optional: website compliance moderation\n  if (advertiserUrl && /^https?:\\/\\//i.test(advertiserUrl)) {\n    try {\n      const text = await fetchPlainText(advertiserUrl);\n      const webCheck = await openAiModerate(text);\n      if (webCheck.flagged) {\n        return NextResponse.json({ id, status: 'rejected', reasons: ['website_noncompliant', ...webCheck.reasons] }, { status: 200 });\n      }\n    } catch (e) {\n      console.warn('Website fetch/moderation failed:', e);\n    }\n  }\n\n  activeByAdvertiser.set(advertiserId, id);\n  return NextResponse.json({ id, status: 'approved', reasons: [] });\n}\n\n\n\n"],"names":[],"mappings":"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","debugId":null}}]
}