{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/tylercharles/TheConsumer/web/src/app/post/create/payment/page.tsx"],"sourcesContent":["'use client';\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\n\nexport default function CreatePayment() {\n  const router = useRouter();\n  const [step, setStep] = useState<'amount' | 'payment'>('amount'); // Step progression\n  const [totalAmount, setTotalAmount] = useState(0);\n  const payoutPer = 25; // fixed 25 cents\n  const [processing, setProcessing] = useState(false);\n  const [error, setError] = useState('');\n\n  // Calculate fee (5% of total)\n  const feeCents = Math.ceil((totalAmount || 0) * 100 * 0.05);\n  const totalCents = (totalAmount || 0) * 100;\n  const remainingCents = totalCents - feeCents;\n  \n  // Calculate how many viewers can be paid\n  const maxViewers = Math.floor(remainingCents / payoutPer);\n\n  const handleAmountSelect = (amount: number) => {\n    setTotalAmount(amount);\n    setError('');\n    // Auto-advance directly to payment\n    setTimeout(() => setStep('payment'), 200);\n  };\n\n  const handleCustomAmount = () => {\n    const custom = parseFloat(prompt('Enter custom amount (minimum $10):') || '0');\n    if (custom >= 10) {\n      setTotalAmount(custom);\n      setError('');\n      setTimeout(() => setStep('payment'), 200);\n    } else if (custom > 0) {\n      setError('Minimum amount is $10');\n    }\n  };\n\n  // payout selection removed; fixed at $0.25\n\n  const handlePayment = async () => {\n    if (totalAmount < 10) {\n      setError('Minimum amount is $10');\n      return;\n    }\n    \n    setProcessing(true);\n    setError('');\n    \n    try {\n      let advertiserId = 'unknown';\n      let videoUrl = '';\n      let creativeId = '';\n      \n      if (typeof window !== 'undefined') {\n        try {\n          advertiserId = localStorage.getItem('ad_businessName') || 'unknown';\n          videoUrl = localStorage.getItem('ad_videoUrl') || '';\n          creativeId = localStorage.getItem('ad_creativeId') || `cr_${Date.now()}`;\n        } catch (e) {\n          console.error('Error reading localStorage:', e);\n        }\n      }\n      \n      const res = await fetch('/api/payment/ad', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          advertiserId,\n          amountCents: totalCents,\n          payoutPer,\n          videoUrl,\n          creativeId\n        })\n      });\n      \n      const data = await res.json();\n      \n      if (!res.ok) {\n        throw new Error(data.error || 'Payment failed');\n      }\n      \n      if (data.url) {\n        window.location.href = data.url;\n      } else {\n        if (typeof window !== 'undefined') {\n          try {\n            localStorage.setItem('ad_payment_complete', '1');\n          } catch (e) {\n            console.error('Error setting localStorage:', e);\n          }\n        }\n        router.push('/post/create/done');\n      }\n    } catch (e: any) {\n      setError(e?.message || 'Payment processing failed');\n      setProcessing(false);\n    }\n  };\n\n  return (\n    <main style={{ minHeight:'70vh', display:'grid', placeItems:'center', padding:24 }}>\n      <div style={{ textAlign:'center', maxWidth:520, width:'100%' }}>\n        {step === 'amount' && (\n          <>\n            <h1>How much will you pay?</h1>\n            <p style={{ color:'var(--muted)', marginTop:6 }}>Select the total amount for your ad campaign.</p>\n            \n            <div style={{ marginTop:24, display:'grid', gridTemplateColumns:'repeat(3, 1fr)', gap:12 }}>\n              {[10, 25, 50, 100].map(amount => (\n                <button\n                  key={amount}\n                  onClick={() => handleAmountSelect(amount)}\n                  style={{\n                    padding:'20px 16px',\n                    borderRadius:12,\n                    border:'2px solid var(--border)',\n                    background:'#ffffff',\n                    color:'var(--foreground)',\n                    fontWeight:600,\n                    cursor:'pointer',\n                    fontSize:'18px'\n                  }}\n                >\n                  ${amount}\n                </button>\n              ))}\n            </div>\n            \n            <button \n              onClick={handleCustomAmount}\n              style={{ \n                marginTop:12, \n                background:'transparent', \n                color:'var(--muted)', \n                padding:'12px 16px', \n                borderRadius:10, \n                border:'1px solid var(--border)',\n                width:'100%',\n                fontWeight:600\n              }}\n            >\n              Other amount\n            </button>\n          </>\n        )}\n\n        {step === 'payment' && totalAmount > 0 && (\n          <>\n            <h1>Review & Pay</h1>\n            <p style={{ color:'var(--muted)', marginTop:6 }}>Review your campaign details and complete payment.</p>\n\n            <div style={{ marginTop:24, padding:20, background:'var(--card)', border:'1px solid var(--border)', borderRadius:12, textAlign:'left' }}>\n              <h3 style={{ fontSize:'16px', marginBottom:12 }}>Campaign Summary:</h3>\n              <div style={{ display:'flex', justifyContent:'space-between', marginBottom:8 }}>\n                <span>Total payment:</span>\n                <span style={{ fontWeight:600 }}>${totalAmount.toFixed(2)}</span>\n              </div>\n              <div style={{ display:'flex', justifyContent:'space-between', marginBottom:8, color:'var(--muted)' }}>\n                <span>Platform fee (5%):</span>\n                <span>-${(feeCents / 100).toFixed(2)}</span>\n              </div>\n              <div style={{ display:'flex', justifyContent:'space-between', marginBottom:8, marginTop:12, paddingTop:12, borderTop:'1px solid var(--border)' }}>\n                <span style={{ fontWeight:600 }}>Available for payouts:</span>\n                <span style={{ fontWeight:700, color:'var(--primary)' }}>${(remainingCents / 100).toFixed(2)}</span>\n              </div>\n              <div style={{ display:'flex', justifyContent:'space-between', marginBottom:8 }}>\n                <span>Payout per viewer:</span>\n                <span style={{ fontWeight:600 }}>${(payoutPer / 100).toFixed(2)}</span>\n              </div>\n              <div style={{ display:'flex', justifyContent:'space-between', marginTop:12, paddingTop:12, borderTop:'1px solid var(--border)' }}>\n                <span style={{ fontWeight:700 }}>Estimated viewers:</span>\n                <span style={{ fontWeight:700, color:'var(--primary)' }}>~{maxViewers}</span>\n              </div>\n            </div>\n\n            {error && <p style={{ marginTop:16, color:'#ff4444' }}>{error}</p>}\n\n            <button \n              onClick={handlePayment}\n              disabled={processing || totalAmount < 10}\n              style={{ \n                marginTop:24, \n                background:processing || totalAmount < 10 ? '#cccccc' : 'var(--primary)', \n                color:'#000', \n                padding:'14px 20px', \n                borderRadius:10, \n                fontWeight:700, \n                width:'100%',\n                cursor:processing || totalAmount < 10 ? 'not-allowed' : 'pointer'\n              }}\n            >\n              {processing ? 'Processing...' : `Pay $${totalAmount.toFixed(2)}`}\n            </button>\n          </>\n        )}\n\n        {step !== 'amount' && (\n          <button \n            onClick={() => router.back()}\n            style={{ \n              marginTop:12, \n              background:'transparent', \n              color:'var(--muted)', \n              padding:'10px 14px', \n              borderRadius:10, \n              border:'1px solid var(--border)',\n              width:'100%',\n              fontSize:'14px'\n            }}\n          >\n            Cancel\n          </button>\n        )}\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;;;AAFA;;;AAIe,SAAS;;IACtB,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAuB,WAAW,mBAAmB;IACrF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,YAAY,IAAI,iBAAiB;IACvC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IAEnC,8BAA8B;IAC9B,MAAM,WAAW,KAAK,IAAI,CAAC,CAAC,eAAe,CAAC,IAAI,MAAM;IACtD,MAAM,aAAa,CAAC,eAAe,CAAC,IAAI;IACxC,MAAM,iBAAiB,aAAa;IAEpC,yCAAyC;IACzC,MAAM,aAAa,KAAK,KAAK,CAAC,iBAAiB;IAE/C,MAAM,qBAAqB,CAAC;QAC1B,eAAe;QACf,SAAS;QACT,mCAAmC;QACnC,WAAW,IAAM,QAAQ,YAAY;IACvC;IAEA,MAAM,qBAAqB;QACzB,MAAM,SAAS,WAAW,OAAO,yCAAyC;QAC1E,IAAI,UAAU,IAAI;YAChB,eAAe;YACf,SAAS;YACT,WAAW,IAAM,QAAQ,YAAY;QACvC,OAAO,IAAI,SAAS,GAAG;YACrB,SAAS;QACX;IACF;IAEA,2CAA2C;IAE3C,MAAM,gBAAgB;QACpB,IAAI,cAAc,IAAI;YACpB,SAAS;YACT;QACF;QAEA,cAAc;QACd,SAAS;QAET,IAAI;YACF,IAAI,eAAe;YACnB,IAAI,WAAW;YACf,IAAI,aAAa;YAEjB,wCAAmC;gBACjC,IAAI;oBACF,eAAe,aAAa,OAAO,CAAC,sBAAsB;oBAC1D,WAAW,aAAa,OAAO,CAAC,kBAAkB;oBAClD,aAAa,aAAa,OAAO,CAAC,oBAAoB,CAAC,GAAG,EAAE,KAAK,GAAG,IAAI;gBAC1E,EAAE,OAAO,GAAG;oBACV,QAAQ,KAAK,CAAC,+BAA+B;gBAC/C;YACF;YAEA,MAAM,MAAM,MAAM,MAAM,mBAAmB;gBACzC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB;oBACA,aAAa;oBACb;oBACA;oBACA;gBACF;YACF;YAEA,MAAM,OAAO,MAAM,IAAI,IAAI;YAE3B,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAChC;YAEA,IAAI,KAAK,GAAG,EAAE;gBACZ,OAAO,QAAQ,CAAC,IAAI,GAAG,KAAK,GAAG;YACjC,OAAO;gBACL,wCAAmC;oBACjC,IAAI;wBACF,aAAa,OAAO,CAAC,uBAAuB;oBAC9C,EAAE,OAAO,GAAG;wBACV,QAAQ,KAAK,CAAC,+BAA+B;oBAC/C;gBACF;gBACA,OAAO,IAAI,CAAC;YACd;QACF,EAAE,OAAO,GAAQ;YACf,SAAS,GAAG,WAAW;YACvB,cAAc;QAChB;IACF;IAEA,qBACE,6LAAC;QAAK,OAAO;YAAE,WAAU;YAAQ,SAAQ;YAAQ,YAAW;YAAU,SAAQ;QAAG;kBAC/E,cAAA,6LAAC;YAAI,OAAO;gBAAE,WAAU;gBAAU,UAAS;gBAAK,OAAM;YAAO;;gBAC1D,SAAS,0BACR;;sCACE,6LAAC;sCAAG;;;;;;sCACJ,6LAAC;4BAAE,OAAO;gCAAE,OAAM;gCAAgB,WAAU;4BAAE;sCAAG;;;;;;sCAEjD,6LAAC;4BAAI,OAAO;gCAAE,WAAU;gCAAI,SAAQ;gCAAQ,qBAAoB;gCAAkB,KAAI;4BAAG;sCACtF;gCAAC;gCAAI;gCAAI;gCAAI;6BAAI,CAAC,GAAG,CAAC,CAAA,uBACrB,6LAAC;oCAEC,SAAS,IAAM,mBAAmB;oCAClC,OAAO;wCACL,SAAQ;wCACR,cAAa;wCACb,QAAO;wCACP,YAAW;wCACX,OAAM;wCACN,YAAW;wCACX,QAAO;wCACP,UAAS;oCACX;;wCACD;wCACG;;mCAbG;;;;;;;;;;sCAkBX,6LAAC;4BACC,SAAS;4BACT,OAAO;gCACL,WAAU;gCACV,YAAW;gCACX,OAAM;gCACN,SAAQ;gCACR,cAAa;gCACb,QAAO;gCACP,OAAM;gCACN,YAAW;4BACb;sCACD;;;;;;;;gBAMJ,SAAS,aAAa,cAAc,mBACnC;;sCACE,6LAAC;sCAAG;;;;;;sCACJ,6LAAC;4BAAE,OAAO;gCAAE,OAAM;gCAAgB,WAAU;4BAAE;sCAAG;;;;;;sCAEjD,6LAAC;4BAAI,OAAO;gCAAE,WAAU;gCAAI,SAAQ;gCAAI,YAAW;gCAAe,QAAO;gCAA2B,cAAa;gCAAI,WAAU;4BAAO;;8CACpI,6LAAC;oCAAG,OAAO;wCAAE,UAAS;wCAAQ,cAAa;oCAAG;8CAAG;;;;;;8CACjD,6LAAC;oCAAI,OAAO;wCAAE,SAAQ;wCAAQ,gBAAe;wCAAiB,cAAa;oCAAE;;sDAC3E,6LAAC;sDAAK;;;;;;sDACN,6LAAC;4CAAK,OAAO;gDAAE,YAAW;4CAAI;;gDAAG;gDAAE,YAAY,OAAO,CAAC;;;;;;;;;;;;;8CAEzD,6LAAC;oCAAI,OAAO;wCAAE,SAAQ;wCAAQ,gBAAe;wCAAiB,cAAa;wCAAG,OAAM;oCAAe;;sDACjG,6LAAC;sDAAK;;;;;;sDACN,6LAAC;;gDAAK;gDAAG,CAAC,WAAW,GAAG,EAAE,OAAO,CAAC;;;;;;;;;;;;;8CAEpC,6LAAC;oCAAI,OAAO;wCAAE,SAAQ;wCAAQ,gBAAe;wCAAiB,cAAa;wCAAG,WAAU;wCAAI,YAAW;wCAAI,WAAU;oCAA0B;;sDAC7I,6LAAC;4CAAK,OAAO;gDAAE,YAAW;4CAAI;sDAAG;;;;;;sDACjC,6LAAC;4CAAK,OAAO;gDAAE,YAAW;gDAAK,OAAM;4CAAiB;;gDAAG;gDAAE,CAAC,iBAAiB,GAAG,EAAE,OAAO,CAAC;;;;;;;;;;;;;8CAE5F,6LAAC;oCAAI,OAAO;wCAAE,SAAQ;wCAAQ,gBAAe;wCAAiB,cAAa;oCAAE;;sDAC3E,6LAAC;sDAAK;;;;;;sDACN,6LAAC;4CAAK,OAAO;gDAAE,YAAW;4CAAI;;gDAAG;gDAAE,CAAC,YAAY,GAAG,EAAE,OAAO,CAAC;;;;;;;;;;;;;8CAE/D,6LAAC;oCAAI,OAAO;wCAAE,SAAQ;wCAAQ,gBAAe;wCAAiB,WAAU;wCAAI,YAAW;wCAAI,WAAU;oCAA0B;;sDAC7H,6LAAC;4CAAK,OAAO;gDAAE,YAAW;4CAAI;sDAAG;;;;;;sDACjC,6LAAC;4CAAK,OAAO;gDAAE,YAAW;gDAAK,OAAM;4CAAiB;;gDAAG;gDAAE;;;;;;;;;;;;;;;;;;;wBAI9D,uBAAS,6LAAC;4BAAE,OAAO;gCAAE,WAAU;gCAAI,OAAM;4BAAU;sCAAI;;;;;;sCAExD,6LAAC;4BACC,SAAS;4BACT,UAAU,cAAc,cAAc;4BACtC,OAAO;gCACL,WAAU;gCACV,YAAW,cAAc,cAAc,KAAK,YAAY;gCACxD,OAAM;gCACN,SAAQ;gCACR,cAAa;gCACb,YAAW;gCACX,OAAM;gCACN,QAAO,cAAc,cAAc,KAAK,gBAAgB;4BAC1D;sCAEC,aAAa,kBAAkB,CAAC,KAAK,EAAE,YAAY,OAAO,CAAC,IAAI;;;;;;;;gBAKrE,SAAS,0BACR,6LAAC;oBACC,SAAS,IAAM,OAAO,IAAI;oBAC1B,OAAO;wBACL,WAAU;wBACV,YAAW;wBACX,OAAM;wBACN,SAAQ;wBACR,cAAa;wBACb,QAAO;wBACP,OAAM;wBACN,UAAS;oBACX;8BACD;;;;;;;;;;;;;;;;;AAOX;GArNwB;;QACP,kJAAS;;;KADF","debugId":null}}]
}